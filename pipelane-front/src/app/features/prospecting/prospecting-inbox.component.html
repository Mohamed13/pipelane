<div class="page">
  <div class="container-page">
    <app-page-header
      title="Prospecting inbox"
      subtitle="Suivez les réponses entrantes, classez les intentions et déclenchez des relances personnalisées."
    >
      <mat-button-toggle-group
        page-actions
        [value]="filter()"
        aria-label="Filtrer les réponses"
        class="inbox-filter-toggle"
      >
        <mat-button-toggle value="all" (click)="setFilter('all')">All</mat-button-toggle>
        <mat-button-toggle value="interested" (click)="setFilter('interested')"
          >Interested</mat-button-toggle
        >
        <mat-button-toggle value="meetingRequested" (click)="setFilter('meetingRequested')"
          >Meetings</mat-button-toggle
        >
        <mat-button-toggle value="unsubscribe" (click)="setFilter('unsubscribe')"
          >Unsub</mat-button-toggle
        >
        <mat-button-toggle value="notInterested" (click)="setFilter('notInterested')"
          >No</mat-button-toggle
        >
      </mat-button-toggle-group>
    </app-page-header>

    <mat-card class="inbox glass">
      <div class="content" *ngIf="!loading(); else loadingTpl">
        <mat-list *ngIf="replies().length; else emptyTpl">
          <mat-list-item *ngFor="let reply of replies()">
            <mat-icon matListItemIcon [ngClass]="reply.intent">mail</mat-icon>
            <div matListItemTitle>{{ reply.subject || '(no subject)' }}</div>
            <div matListItemLine>
              {{ reply.prospectEmail }} • {{ reply.receivedAtUtc | date: 'short' }} • Intent:
              {{ reply.intent | titlecase }}
            </div>
            <div class="buttons">
              <button mat-icon-button matTooltip="Analyse intent" (click)="classify(reply)">
                <mat-icon>insights</mat-icon>
              </button>
              <button
                mat-icon-button
                matTooltip="Generate auto-reply"
                (click)="draftAutoReply(reply)"
              >
                <mat-icon>auto_fix_high</mat-icon>
              </button>
            </div>
          </mat-list-item>
        </mat-list>
      </div>
    </mat-card>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="loading">
    <mat-icon class="spin">hourglass_empty</mat-icon>
    Loading replies…
  </div>
</ng-template>

<ng-template #emptyTpl>
  <div class="empty">
    <p>No replies yet. Launch a campaign to see responses here.</p>
  </div>
</ng-template>
