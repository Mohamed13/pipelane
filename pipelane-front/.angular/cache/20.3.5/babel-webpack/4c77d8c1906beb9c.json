{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { inject, signal, effect } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatTableDataSource, MatTableModule } from '@angular/material/table';\nimport { MatPaginator, MatPaginatorModule } from '@angular/material/paginator';\nimport { MatSort, MatSortModule } from '@angular/material/sort';\nimport { toSignal } from '@angular/core/rxjs-interop';\nimport { of } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { ApiService } from '../../core/api.service';\nimport { environment } from '../../core/environment';\nimport { ThemeService } from '../../core/theme.service';\nimport { KpiCardComponent } from '../../shared/ui/kpi-card.component';\nimport { ChartCardComponent } from '../../shared/ui/chart-card.component';\nimport { RevealOnScrollDirective } from '../../shared/ui/reveal-on-scroll.directive';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/card\";\nimport * as i2 from \"@angular/material/table\";\nimport * as i3 from \"@angular/material/paginator\";\nimport * as i4 from \"@angular/material/sort\";\nimport * as i5 from \"@angular/common\";\nconst _c0 = () => [5, 10, 20];\nfunction AnalyticsOverviewComponent_th_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Channel\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AnalyticsOverviewComponent_td_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const row_r1 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, row_r1.channel));\n  }\n}\nfunction AnalyticsOverviewComponent_th_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"th\", 21);\n    i0.ɵɵtext(1, \"Count\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AnalyticsOverviewComponent_td_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"td\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const row_r2 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(row_r2.count);\n  }\n}\nfunction AnalyticsOverviewComponent_tr_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 23);\n  }\n}\nfunction AnalyticsOverviewComponent_tr_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"tr\", 24);\n  }\n}\nexport let AnalyticsOverviewComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AnalyticsOverviewComponent {\n    constructor() {\n      this.api = inject(ApiService);\n      this.theme = inject(ThemeService).theme;\n      this.analytics$ = this.api.getAnalyticsOverview().pipe(catchError(() => of(null)));\n      this.analytics = toSignal(this.analytics$, {\n        initialValue: null\n      });\n      this.table = new MatTableDataSource(DEMO_ROWS);\n      this.displayedColumns = ['channel', 'count'];\n      this.totalMessages = signal(DEMO_TOTAL, ...(ngDevMode ? [{\n        debugName: \"totalMessages\"\n      }] : []));\n      this.deliveredCount = signal(210, ...(ngDevMode ? [{\n        debugName: \"deliveredCount\"\n      }] : []));\n      this.readCount = signal(150, ...(ngDevMode ? [{\n        debugName: \"readCount\"\n      }] : []));\n      this.failedCount = signal(12, ...(ngDevMode ? [{\n        debugName: \"failedCount\"\n      }] : []));\n      this.lineData = createLineData(DEMO_TOTAL);\n      this.barData = createBarData(DEMO_ROWS);\n      this.donutData = createDonutData(DEMO_TOTAL, 210, 12);\n      this.chartOptions = createChartOptions();\n      effect(() => {\n        const theme = this.theme();\n        theme; // trigger re-evaluation when theme changes\n        this.refreshCharts();\n      });\n      effect(() => {\n        const snapshot = this.analytics();\n        if (!snapshot || environment.USE_DEMO_DATA) return;\n        this.applyAnalytics(snapshot);\n      });\n    }\n    ngAfterViewInit() {\n      this.table.paginator = this.paginator;\n      this.table.sort = this.sort;\n    }\n    applyAnalytics(snapshot) {\n      const total = snapshot?.total ?? DEMO_TOTAL;\n      this.totalMessages.set(total);\n      const delivered = snapshot?.byStatus?.delivered ?? snapshot?.delivered ?? Math.round(total * 0.78);\n      const read = snapshot?.byStatus?.read ?? snapshot?.read ?? Math.round(total * 0.6);\n      const failed = snapshot?.byStatus?.failed ?? snapshot?.failed ?? Math.max(Math.round(total * 0.05), 1);\n      this.deliveredCount.set(delivered);\n      this.readCount.set(read);\n      this.failedCount.set(failed);\n      const rows = snapshot?.byChannel?.map(c => ({\n        channel: c.channel,\n        count: c.count\n      })) ?? DEMO_ROWS;\n      this.table.data = rows;\n      this.refreshCharts(rows);\n    }\n    refreshCharts(rows = this.table.data) {\n      const total = this.totalMessages();\n      const delivered = this.deliveredCount();\n      const failed = this.failedCount();\n      this.chartOptions = createChartOptions();\n      this.lineData = createLineData(total);\n      this.barData = createBarData(rows);\n      this.donutData = createDonutData(total, delivered, failed);\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AnalyticsOverviewComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AnalyticsOverviewComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AnalyticsOverviewComponent,\n      selectors: [[\"pl-analytics-overview\"]],\n      viewQuery: function AnalyticsOverviewComponent_Query(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵviewQuery(MatPaginator, 5);\n          i0.ɵɵviewQuery(MatSort, 5);\n        }\n        if (rf & 2) {\n          let _t;\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.paginator = _t.first);\n          i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.sort = _t.first);\n        }\n      },\n      decls: 25,\n      vars: 24,\n      consts: [[\"plRevealOnScroll\", \"\", 1, \"grid-responsive\"], [\"label\", \"Total Messages\", 3, \"value\", \"delta\"], [\"label\", \"Delivered\", 3, \"value\", \"delta\"], [\"label\", \"Read\", 3, \"value\", \"delta\"], [\"label\", \"Failed\", 3, \"value\", \"delta\"], [\"plRevealOnScroll\", \"\", 1, \"grid-responsive\", \"charts\"], [\"title\", \"Messages (7d)\", 3, \"type\", \"data\", \"options\"], [\"title\", \"By Channel\", 3, \"type\", \"data\", \"options\"], [\"title\", \"Breakdown\", 3, \"type\", \"data\", \"options\"], [\"plRevealOnScroll\", \"\"], [1, \"surface-card\"], [1, \"table-header\"], [1, \"table-wrapper\"], [\"mat-table\", \"\", \"matSort\", \"\", 1, \"mat-elevation-z1\", 3, \"dataSource\"], [\"matColumnDef\", \"channel\"], [\"mat-header-cell\", \"\", \"mat-sort-header\", \"\", 4, \"matHeaderCellDef\"], [\"mat-cell\", \"\", 4, \"matCellDef\"], [\"matColumnDef\", \"count\"], [\"mat-header-row\", \"\", 4, \"matHeaderRowDef\", \"matHeaderRowDefSticky\"], [\"mat-row\", \"\", \"class\", \"table-row\", 4, \"matRowDef\", \"matRowDefColumns\"], [3, \"pageSize\", \"pageSizeOptions\"], [\"mat-header-cell\", \"\", \"mat-sort-header\", \"\"], [\"mat-cell\", \"\"], [\"mat-header-row\", \"\"], [\"mat-row\", \"\", 1, \"table-row\"]],\n      template: function AnalyticsOverviewComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"section\", 0);\n          i0.ɵɵelement(1, \"pl-kpi-card\", 1)(2, \"pl-kpi-card\", 2)(3, \"pl-kpi-card\", 3)(4, \"pl-kpi-card\", 4);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"section\", 5);\n          i0.ɵɵelement(6, \"pl-chart-card\", 6)(7, \"pl-chart-card\", 7)(8, \"pl-chart-card\", 8);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"section\", 9)(10, \"mat-card\", 10)(11, \"div\", 11)(12, \"h3\");\n          i0.ɵɵtext(13, \"Recent Channel Activity\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(14, \"div\", 12)(15, \"table\", 13);\n          i0.ɵɵelementContainerStart(16, 14);\n          i0.ɵɵtemplate(17, AnalyticsOverviewComponent_th_17_Template, 2, 0, \"th\", 15)(18, AnalyticsOverviewComponent_td_18_Template, 3, 3, \"td\", 16);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵelementContainerStart(19, 17);\n          i0.ɵɵtemplate(20, AnalyticsOverviewComponent_th_20_Template, 2, 0, \"th\", 15)(21, AnalyticsOverviewComponent_td_21_Template, 2, 1, \"td\", 16);\n          i0.ɵɵelementContainerEnd();\n          i0.ɵɵtemplate(22, AnalyticsOverviewComponent_tr_22_Template, 1, 0, \"tr\", 18)(23, AnalyticsOverviewComponent_tr_23_Template, 1, 0, \"tr\", 19);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(24, \"mat-paginator\", 20);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", ctx.totalMessages())(\"delta\", 3.5);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", ctx.deliveredCount())(\"delta\", 1.2);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", ctx.readCount())(\"delta\", -0.8);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"value\", ctx.failedCount())(\"delta\", 0.4);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"type\", \"line\")(\"data\", ctx.lineData)(\"options\", ctx.chartOptions);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"type\", \"bar\")(\"data\", ctx.barData)(\"options\", ctx.chartOptions);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"type\", \"doughnut\")(\"data\", ctx.donutData)(\"options\", ctx.chartOptions);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"dataSource\", ctx.table);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"matHeaderRowDef\", ctx.displayedColumns)(\"matHeaderRowDefSticky\", true);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"matRowDefColumns\", ctx.displayedColumns);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"pageSize\", 5)(\"pageSizeOptions\", i0.ɵɵpureFunction0(23, _c0));\n        }\n      },\n      dependencies: [CommonModule, MatCardModule, i1.MatCard, MatTableModule, i2.MatTable, i2.MatHeaderCellDef, i2.MatHeaderRowDef, i2.MatColumnDef, i2.MatCellDef, i2.MatRowDef, i2.MatHeaderCell, i2.MatCell, i2.MatHeaderRow, i2.MatRow, MatPaginatorModule, i3.MatPaginator, MatSortModule, i4.MatSort, i4.MatSortHeader, KpiCardComponent, ChartCardComponent, RevealOnScrollDirective, i5.TitleCasePipe],\n      styles: [\".charts[_ngcontent-%COMP%]{margin-top:var(--space-5)}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--space-3)}.table-wrapper[_ngcontent-%COMP%]{overflow-x:auto}.table-row[_ngcontent-%COMP%]{cursor:pointer;transition:background var(--transition-fast)}.table-row[_ngcontent-%COMP%]:hover{background:var(--color-surface-alt)}[_nghost-%COMP%]     .mat-mdc-table .mat-mdc-row, [_nghost-%COMP%]     .mat-mdc-table .mat-mdc-header-row{height:48px}@media (max-width: 768px){.charts[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"],\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return AnalyticsOverviewComponent;\n})();\nconst DEMO_ROWS = [{\n  channel: 'whatsapp',\n  count: 132\n}, {\n  channel: 'email',\n  count: 98\n}, {\n  channel: 'sms',\n  count: 45\n}];\nconst DEMO_TOTAL = DEMO_ROWS.reduce((sum, r) => sum + r.count, 0);\nfunction cssVar(name) {\n  return getComputedStyle(document.documentElement).getPropertyValue(name).trim();\n}\nfunction rgba(hex, alpha) {\n  if (!hex.startsWith('#') || hex.length < 7) return hex;\n  const r = parseInt(hex.slice(1, 3), 16);\n  const g = parseInt(hex.slice(3, 5), 16);\n  const b = parseInt(hex.slice(5, 7), 16);\n  return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n}\nfunction createChartOptions() {\n  return {\n    responsive: true,\n    maintainAspectRatio: false,\n    plugins: {\n      legend: {\n        display: false,\n        labels: {\n          color: cssVar('--color-text-muted')\n        }\n      },\n      tooltip: {\n        backgroundColor: cssVar('--color-surface'),\n        bodyColor: cssVar('--color-text'),\n        titleColor: cssVar('--color-text'),\n        borderColor: cssVar('--color-border'),\n        borderWidth: 1,\n        displayColors: false\n      }\n    },\n    scales: {\n      x: {\n        ticks: {\n          color: cssVar('--color-text-muted')\n        },\n        grid: {\n          color: cssVar('--color-border')\n        }\n      },\n      y: {\n        ticks: {\n          color: cssVar('--color-text-muted')\n        },\n        grid: {\n          color: cssVar('--color-border')\n        }\n      }\n    }\n  };\n}\nfunction createLineData(total) {\n  const primary = cssVar('--color-primary');\n  const baseline = Math.max(Math.round(total / 7), 1);\n  const series = Array.from({\n    length: 7\n  }, (_, index) => baseline + Math.round((Math.sin(index) + 1) * baseline * 0.25));\n  return {\n    labels: ['-6d', '-5d', '-4d', '-3d', '-2d', '-1d', 'today'],\n    datasets: [{\n      data: series,\n      label: 'Messages',\n      borderColor: primary,\n      backgroundColor: rgba(primary, 0.2),\n      fill: true,\n      tension: 0.35\n    }]\n  };\n}\nfunction createBarData(rows) {\n  const palette = [cssVar('--color-primary'), cssVar('--color-accent'), '#a78bfa'];\n  return {\n    labels: rows.map(r => r.channel.toUpperCase()),\n    datasets: [{\n      data: rows.map(r => r.count),\n      label: 'By channel',\n      backgroundColor: palette\n    }]\n  };\n}\nfunction createDonutData(total, delivered, failed) {\n  return {\n    labels: ['Sent', 'Delivered', 'Failed'],\n    datasets: [{\n      data: [total, delivered, failed],\n      backgroundColor: [cssVar('--color-primary'), '#10b981', cssVar('--color-warn')],\n      hoverOffset: 6\n    }]\n  };\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}