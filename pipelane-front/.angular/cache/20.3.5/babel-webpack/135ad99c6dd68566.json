{"ast":null,"code":"import { inject, signal } from '@angular/core';\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { ApiService } from '../../core/api.service';\nimport { ChannelLabels } from '../../core/models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/material/card\";\nimport * as i3 from \"@angular/material/form-field\";\nimport * as i4 from \"@angular/material/input\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/icon\";\nimport * as i7 from \"@angular/material/list\";\nexport let OnboardingComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class OnboardingComponent {\n    constructor() {\n      this.api = inject(ApiService);\n      this.fb = inject(FormBuilder);\n      this.snackbar = inject(MatSnackBar);\n      this.saving = signal(false, ...(ngDevMode ? [{\n        debugName: \"saving\"\n      }] : []));\n      this.testingEmail = signal(false, ...(ngDevMode ? [{\n        debugName: \"testingEmail\"\n      }] : []));\n      this.whatsappForm = this.fb.group({\n        phone_number_id: this.fb.control(''),\n        access_token: this.fb.control(''),\n        verify_token: this.fb.control('')\n      });\n      this.emailForm = this.fb.group({\n        apiKey: this.fb.control('', Validators.required),\n        domain: this.fb.control('', Validators.required)\n      });\n      this.emailTestForm = this.fb.group({\n        contactId: this.fb.control('', Validators.required),\n        message: this.fb.control('This is a test email from Pipelane.')\n      });\n      this.smsForm = this.fb.group({\n        apiKey: this.fb.control('', Validators.required)\n      });\n    }\n    save(channel) {\n      const form = this.getForm(channel);\n      if (form.invalid) {\n        form.markAllAsTouched();\n        return;\n      }\n      const value = form.value;\n      const payload = {\n        channel,\n        settings: this.toSettingsRecord(value)\n      };\n      this.saving.set(true);\n      this.api.saveChannelSettings(payload).subscribe({\n        next: () => {\n          this.saving.set(false);\n          this.snackbar.open(`${ChannelLabels[channel]} settings saved`, 'Close', {\n            duration: 3000\n          });\n        },\n        error: () => {\n          this.saving.set(false);\n          this.snackbar.open(`Failed to save ${ChannelLabels[channel]} settings`, 'Dismiss', {\n            duration: 4000\n          });\n        }\n      });\n    }\n    sendTestEmail() {\n      if (this.emailTestForm.invalid) {\n        this.emailTestForm.markAllAsTouched();\n        return;\n      }\n      const {\n        contactId,\n        message\n      } = this.emailTestForm.value;\n      if (!contactId) return;\n      this.testingEmail.set(true);\n      this.api.sendMessage({\n        contactId: contactId.trim(),\n        channel: 'email',\n        type: 'text',\n        text: (message ?? 'This is a test email from Pipelane.').trim()\n      }).subscribe({\n        next: () => {\n          this.testingEmail.set(false);\n          this.snackbar.open('Test email sent', 'Close', {\n            duration: 4000\n          });\n        },\n        error: () => {\n          this.testingEmail.set(false);\n          this.snackbar.open('Unable to send test email', 'Dismiss', {\n            duration: 4000\n          });\n        }\n      });\n    }\n    getForm(channel) {\n      switch (channel) {\n        case 'whatsapp':\n          return this.whatsappForm;\n        case 'email':\n          return this.emailForm;\n        case 'sms':\n        default:\n          return this.smsForm;\n      }\n    }\n    toSettingsRecord(value) {\n      return Object.entries(value).filter(([, val]) => typeof val === 'string' && val !== '').reduce((acc, [key, val]) => {\n        acc[key] = val;\n        return acc;\n      }, {});\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function OnboardingComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || OnboardingComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: OnboardingComponent,\n      selectors: [[\"pl-onboarding\"]],\n      decls: 77,\n      vars: 8,\n      consts: [[1, \"grid-responsive\"], [1, \"surface-card\"], [1, \"body-text-muted\"], [1, \"form-grid\", 3, \"ngSubmit\", \"formGroup\"], [\"appearance\", \"outline\"], [\"matInput\", \"\", \"formControlName\", \"phone_number_id\"], [\"matInput\", \"\", \"formControlName\", \"access_token\"], [\"matInput\", \"\", \"formControlName\", \"verify_token\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"disabled\"], [\"matInput\", \"\", \"formControlName\", \"apiKey\"], [\"matInput\", \"\", \"formControlName\", \"domain\"], [1, \"test-block\"], [\"matInput\", \"\", \"formControlName\", \"contactId\", \"placeholder\", \"Contact GUID\"], [\"matInput\", \"\", \"rows\", \"3\", \"formControlName\", \"message\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", \"type\", \"submit\", 3, \"disabled\"]],\n      template: function OnboardingComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"mat-card\", 1)(2, \"header\")(3, \"h2\");\n          i0.ɵɵtext(4, \"WhatsApp\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"p\", 2);\n          i0.ɵɵtext(6, \"Configure Meta WhatsApp Cloud credentials.\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(7, \"form\", 3);\n          i0.ɵɵlistener(\"ngSubmit\", function OnboardingComponent_Template_form_ngSubmit_7_listener() {\n            return ctx.save(\"whatsapp\");\n          });\n          i0.ɵɵelementStart(8, \"mat-form-field\", 4)(9, \"mat-label\");\n          i0.ɵɵtext(10, \"Phone number ID\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(11, \"input\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"mat-form-field\", 4)(13, \"mat-label\");\n          i0.ɵɵtext(14, \"Access token\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(15, \"input\", 6);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"mat-form-field\", 4)(17, \"mat-label\");\n          i0.ɵɵtext(18, \"Verify token\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(19, \"input\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"button\", 8)(21, \"mat-icon\");\n          i0.ɵɵtext(22, \"save\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(23, \" Save WhatsApp settings \");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(24, \"mat-card\", 1)(25, \"header\")(26, \"h2\");\n          i0.ɵɵtext(27, \"Email ESP\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"p\", 2);\n          i0.ɵɵtext(29, \"Setup your transactional email provider.\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(30, \"form\", 3);\n          i0.ɵɵlistener(\"ngSubmit\", function OnboardingComponent_Template_form_ngSubmit_30_listener() {\n            return ctx.save(\"email\");\n          });\n          i0.ɵɵelementStart(31, \"mat-form-field\", 4)(32, \"mat-label\");\n          i0.ɵɵtext(33, \"API key\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(34, \"input\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"mat-form-field\", 4)(36, \"mat-label\");\n          i0.ɵɵtext(37, \"Domain\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(38, \"input\", 10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(39, \"button\", 8)(40, \"mat-icon\");\n          i0.ɵɵtext(41, \"save\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(42, \" Save email settings \");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(43, \"mat-divider\");\n          i0.ɵɵelementStart(44, \"section\", 11)(45, \"h3\");\n          i0.ɵɵtext(46, \"Test delivery\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(47, \"p\", 2);\n          i0.ɵɵtext(48, \"Send a quick test message to an existing contact.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(49, \"form\", 3);\n          i0.ɵɵlistener(\"ngSubmit\", function OnboardingComponent_Template_form_ngSubmit_49_listener() {\n            return ctx.sendTestEmail();\n          });\n          i0.ɵɵelementStart(50, \"mat-form-field\", 4)(51, \"mat-label\");\n          i0.ɵɵtext(52, \"Contact ID\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(53, \"input\", 12);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(54, \"mat-form-field\", 4)(55, \"mat-label\");\n          i0.ɵɵtext(56, \"Message\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(57, \"textarea\", 13);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(58, \"button\", 14)(59, \"mat-icon\");\n          i0.ɵɵtext(60, \"email\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(61, \" Send test email \");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(62, \"mat-card\", 1)(63, \"header\")(64, \"h2\");\n          i0.ɵɵtext(65, \"SMS\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(66, \"p\", 2);\n          i0.ɵɵtext(67, \"Link your SMS provider credentials.\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(68, \"form\", 3);\n          i0.ɵɵlistener(\"ngSubmit\", function OnboardingComponent_Template_form_ngSubmit_68_listener() {\n            return ctx.save(\"sms\");\n          });\n          i0.ɵɵelementStart(69, \"mat-form-field\", 4)(70, \"mat-label\");\n          i0.ɵɵtext(71, \"API key\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(72, \"input\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(73, \"button\", 8)(74, \"mat-icon\");\n          i0.ɵɵtext(75, \"save\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(76, \" Save SMS settings \");\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"formGroup\", ctx.whatsappForm);\n          i0.ɵɵadvance(13);\n          i0.ɵɵproperty(\"disabled\", ctx.whatsappForm.invalid || ctx.saving());\n          i0.ɵɵadvance(10);\n          i0.ɵɵproperty(\"formGroup\", ctx.emailForm);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"disabled\", ctx.emailForm.invalid || ctx.saving());\n          i0.ɵɵadvance(10);\n          i0.ɵɵproperty(\"formGroup\", ctx.emailTestForm);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"disabled\", ctx.emailTestForm.invalid || ctx.testingEmail());\n          i0.ɵɵadvance(10);\n          i0.ɵɵproperty(\"formGroup\", ctx.smsForm);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"disabled\", ctx.smsForm.invalid || ctx.saving());\n        }\n      },\n      dependencies: [ReactiveFormsModule, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, MatCardModule, i2.MatCard, MatFormFieldModule, i3.MatFormField, i3.MatLabel, MatInputModule, i4.MatInput, MatButtonModule, i5.MatButton, MatIconModule, i6.MatIcon, MatSnackBarModule, MatDividerModule, i7.MatDivider],\n      styles: [\"header[_ngcontent-%COMP%]{margin-bottom:var(--space-3)}.form-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-3)}mat-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-3)}.test-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-3)}\"],\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return OnboardingComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}