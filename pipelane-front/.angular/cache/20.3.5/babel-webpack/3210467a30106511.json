{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { computed, inject, signal } from '@angular/core';\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatStepperModule } from '@angular/material/stepper';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatNativeDateModule } from '@angular/material/core';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatSnackBar, MatSnackBarModule } from '@angular/material/snack-bar';\nimport { ApiService } from '../../core/api.service';\nimport { ChannelLabels } from '../../core/models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/material/card\";\nimport * as i4 from \"@angular/material/stepper\";\nimport * as i5 from \"@angular/material/form-field\";\nimport * as i6 from \"@angular/material/input\";\nimport * as i7 from \"@angular/material/select\";\nimport * as i8 from \"@angular/material/button\";\nimport * as i9 from \"@angular/material/icon\";\nimport * as i10 from \"@angular/material/datepicker\";\nimport * as i11 from \"@angular/material/chips\";\nfunction CampaignBuilderComponent_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Campaign details\");\n  }\n}\nfunction CampaignBuilderComponent_mat_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const channel_r2 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"value\", channel_r2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.ChannelLabels[channel_r2], \" \");\n  }\n}\nfunction CampaignBuilderComponent_mat_option_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const channel_r4 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"value\", channel_r4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.ChannelLabels[channel_r4], \" \");\n  }\n}\nfunction CampaignBuilderComponent_div_23_mat_chip_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-chip\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const channel_r5 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.ChannelLabels[channel_r5], \" \");\n  }\n}\nfunction CampaignBuilderComponent_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtemplate(1, CampaignBuilderComponent_div_23_mat_chip_1_Template, 2, 1, \"mat-chip\", 25);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r2.detailsGroup.value.fallbackOrder);\n  }\n}\nfunction CampaignBuilderComponent_ng_template_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Template & schedule\");\n  }\n}\nfunction CampaignBuilderComponent_mat_option_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"titlecase\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const template_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", template_r6.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate3(\" \", template_r6.name, \" (\", template_r6.lang.toUpperCase(), \" \\u00B7 \", i0.ɵɵpipeBind1(2, 4, template_r6.channel), \") \");\n  }\n}\nfunction CampaignBuilderComponent_pre_48_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"pre\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"json\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const payload_r7 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(2, 1, payload_r7));\n  }\n}\nexport let CampaignBuilderComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class CampaignBuilderComponent {\n    get detailsGroup() {\n      return this.form.get('details');\n    }\n    get templateGroup() {\n      return this.form.get('template');\n    }\n    constructor() {\n      this.api = inject(ApiService);\n      this.fb = inject(FormBuilder);\n      this.snackbar = inject(MatSnackBar);\n      this.ChannelLabels = ChannelLabels;\n      this.channels = ['whatsapp', 'email', 'sms'];\n      this.templates = signal([], ...(ngDevMode ? [{\n        debugName: \"templates\"\n      }] : []));\n      this.creating = signal(false, ...(ngDevMode ? [{\n        debugName: \"creating\"\n      }] : []));\n      this.form = this.fb.group({\n        details: this.fb.group({\n          name: ['Untitled campaign', [Validators.required, Validators.minLength(3)]],\n          primaryChannel: ['whatsapp', Validators.required],\n          fallbackOrder: this.fb.control([])\n        }),\n        template: this.fb.group({\n          templateId: ['', Validators.required],\n          scheduledAt: [null],\n          segmentJson: ['{}', Validators.required]\n        })\n      });\n      this.summary = computed(() => {\n        if (this.form.invalid) return null;\n        return this.buildPayload();\n      }, ...(ngDevMode ? [{\n        debugName: \"summary\"\n      }] : []));\n      this.api.getTemplates().subscribe({\n        next: templates => this.templates.set(templates ?? [])\n      });\n    }\n    fallbackOptions() {\n      const primary = this.detailsGroup.value.primaryChannel;\n      return this.channels.filter(ch => ch !== primary);\n    }\n    createCampaign() {\n      if (this.form.invalid) {\n        this.form.markAllAsTouched();\n        return;\n      }\n      const payload = this.buildPayload();\n      if (!payload) return;\n      this.creating.set(true);\n      this.api.createCampaign(payload).subscribe({\n        next: res => {\n          this.creating.set(false);\n          this.snackbar.open(`Campaign created (ID: ${res.id})`, 'Close', {\n            duration: 4000\n          });\n          this.form.reset({\n            details: {\n              name: 'Untitled campaign',\n              primaryChannel: 'whatsapp',\n              fallbackOrder: []\n            },\n            template: {\n              templateId: '',\n              scheduledAt: null,\n              segmentJson: '{}'\n            }\n          });\n        },\n        error: () => {\n          this.creating.set(false);\n          this.snackbar.open('Failed to create campaign', 'Dismiss', {\n            duration: 4000\n          });\n        }\n      });\n    }\n    buildPayload() {\n      if (this.form.invalid) return null;\n      const details = this.detailsGroup.value;\n      const template = this.templateGroup.value;\n      const scheduledAtUtc = template.scheduledAt ? new Date(template.scheduledAt).toISOString() : null;\n      return {\n        name: details.name,\n        primaryChannel: details.primaryChannel,\n        fallbackOrderJson: (details.fallbackOrder ?? []).length ? JSON.stringify(details.fallbackOrder) : null,\n        templateId: template.templateId,\n        segmentJson: template.segmentJson ?? '{}',\n        scheduledAtUtc\n      };\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function CampaignBuilderComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || CampaignBuilderComponent)();\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: CampaignBuilderComponent,\n      selectors: [[\"pl-campaign-builder\"]],\n      decls: 58,\n      vars: 15,\n      consts: [[\"picker\", \"\"], [1, \"surface-card\"], [1, \"body-text-muted\"], [3, \"linear\", \"formGroup\"], [3, \"stepControl\"], [\"matStepLabel\", \"\"], [1, \"step-content\", 3, \"formGroup\"], [\"appearance\", \"outline\"], [\"matInput\", \"\", \"formControlName\", \"name\", \"placeholder\", \"e.g. Spring Promo\"], [\"formControlName\", \"primaryChannel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"formControlName\", \"fallbackOrder\", \"multiple\", \"\"], [\"class\", \"chip-row\", 4, \"ngIf\"], [1, \"actions\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"matStepperNext\", \"\", 3, \"disabled\"], [\"formControlName\", \"templateId\"], [\"matInput\", \"\", \"formControlName\", \"scheduledAt\", 3, \"matDatepicker\"], [\"matSuffix\", \"\", 3, \"for\"], [\"appearance\", \"outline\", 1, \"segment\"], [\"matInput\", \"\", \"formControlName\", \"segmentJson\", \"rows\", \"4\"], [4, \"ngIf\"], [\"mat-button\", \"\", \"matStepperPrevious\", \"\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", \"disabled\"], [3, \"value\"], [1, \"chip-row\"], [\"color\", \"accent\", \"selected\", \"\", 4, \"ngFor\", \"ngForOf\"], [\"color\", \"accent\", \"selected\", \"\"]],\n      template: function CampaignBuilderComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"mat-card\", 1)(1, \"h2\");\n          i0.ɵɵtext(2, \"Campaign Builder\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"p\", 2);\n          i0.ɵɵtext(4, \"Create a multi-channel campaign with fallbacks and schedule.\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"mat-horizontal-stepper\", 3)(6, \"mat-step\", 4);\n          i0.ɵɵtemplate(7, CampaignBuilderComponent_ng_template_7_Template, 1, 0, \"ng-template\", 5);\n          i0.ɵɵelementStart(8, \"div\", 6)(9, \"mat-form-field\", 7)(10, \"mat-label\");\n          i0.ɵɵtext(11, \"Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(12, \"input\", 8);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"mat-form-field\", 7)(14, \"mat-label\");\n          i0.ɵɵtext(15, \"Primary channel\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"mat-select\", 9);\n          i0.ɵɵtemplate(17, CampaignBuilderComponent_mat_option_17_Template, 2, 2, \"mat-option\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"mat-form-field\", 7)(19, \"mat-label\");\n          i0.ɵɵtext(20, \"Fallback channels\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"mat-select\", 11);\n          i0.ɵɵtemplate(22, CampaignBuilderComponent_mat_option_22_Template, 2, 2, \"mat-option\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(23, CampaignBuilderComponent_div_23_Template, 2, 1, \"div\", 12);\n          i0.ɵɵelementStart(24, \"div\", 13)(25, \"button\", 14);\n          i0.ɵɵtext(26, \" Next \");\n          i0.ɵɵelementStart(27, \"mat-icon\");\n          i0.ɵɵtext(28, \"arrow_forward\");\n          i0.ɵɵelementEnd()()()()();\n          i0.ɵɵelementStart(29, \"mat-step\", 4);\n          i0.ɵɵtemplate(30, CampaignBuilderComponent_ng_template_30_Template, 1, 0, \"ng-template\", 5);\n          i0.ɵɵelementStart(31, \"div\", 6)(32, \"mat-form-field\", 7)(33, \"mat-label\");\n          i0.ɵɵtext(34, \"Template\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"mat-select\", 15);\n          i0.ɵɵtemplate(36, CampaignBuilderComponent_mat_option_36_Template, 3, 6, \"mat-option\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(37, \"mat-form-field\", 7)(38, \"mat-label\");\n          i0.ɵɵtext(39, \"Schedule at (UTC)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(40, \"input\", 16)(41, \"mat-datepicker-toggle\", 17)(42, \"mat-datepicker\", null, 0);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(44, \"mat-form-field\", 18)(45, \"mat-label\");\n          i0.ɵɵtext(46, \"Audience segment (JSON)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(47, \"textarea\", 19);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(48, CampaignBuilderComponent_pre_48_Template, 3, 3, \"pre\", 20);\n          i0.ɵɵelementStart(49, \"div\", 13)(50, \"button\", 21)(51, \"mat-icon\");\n          i0.ɵɵtext(52, \"arrow_back\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(53, \" Back \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(54, \"button\", 22);\n          i0.ɵɵlistener(\"click\", function CampaignBuilderComponent_Template_button_click_54_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.createCampaign());\n          });\n          i0.ɵɵelementStart(55, \"mat-icon\");\n          i0.ɵɵtext(56, \"check\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtext(57, \" Launch campaign \");\n          i0.ɵɵelementEnd()()()()()();\n        }\n        if (rf & 2) {\n          const picker_r8 = i0.ɵɵreference(43);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"linear\", true)(\"formGroup\", ctx.form);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"stepControl\", ctx.detailsGroup);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"formGroup\", ctx.detailsGroup);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngForOf\", ctx.channels);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", ctx.fallbackOptions());\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.detailsGroup.value.fallbackOrder == null ? null : ctx.detailsGroup.value.fallbackOrder.length);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.detailsGroup.invalid);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"stepControl\", ctx.templateGroup);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"formGroup\", ctx.templateGroup);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", ctx.templates());\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"matDatepicker\", picker_r8);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"for\", picker_r8);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngIf\", ctx.summary());\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"disabled\", ctx.templateGroup.invalid || ctx.creating());\n        }\n      },\n      dependencies: [CommonModule, i1.NgForOf, i1.NgIf, ReactiveFormsModule, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName, MatCardModule, i3.MatCard, MatStepperModule, i4.MatStep, i4.MatStepLabel, i4.MatStepper, i4.MatStepperNext, i4.MatStepperPrevious, MatFormFieldModule, i5.MatFormField, i5.MatLabel, i5.MatSuffix, MatInputModule, i6.MatInput, MatSelectModule, i7.MatSelect, i7.MatOption, MatButtonModule, i8.MatButton, MatIconModule, i9.MatIcon, MatDatepickerModule, i10.MatDatepicker, i10.MatDatepickerInput, i10.MatDatepickerToggle, MatNativeDateModule, MatChipsModule, i11.MatChip, MatSnackBarModule, i1.JsonPipe, i1.TitleCasePipe],\n      styles: [\".step-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--space-3)}.chip-row[_ngcontent-%COMP%]{display:flex;gap:var(--space-2);flex-wrap:wrap}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--space-3);margin-top:var(--space-4)}.segment[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{font-family:JetBrains Mono,monospace}\"],\n      changeDetection: 0\n    }));\n  }\n  _staticBlock();\n  return CampaignBuilderComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}